(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{14:function(t,e,n){},15:function(t,e,n){},17:function(t,e,n){},23:function(t,e,n){"use strict";n.r(e);var i=n(0),a=n.n(i),o=n(5),c=n.n(o),s=(n(14),n(15),n(2)),r=n(1);function h(t){return t?{width:t.offsetWidth,height:t.offsetHeight}:{width:0,height:0}}n(17);var l=function(t){var e=t.animator,n=Object(i.useRef)(null),o=function(t,e){var n=Object(i.useState)(h(t?t.current:{})),a=Object(s.a)(n,2),o=a[0],c=a[1],l=Object(i.useCallback)(function(){if(t.current&&(c(h(t.current)),e)){var n=!0,i=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0)(0,o.value)()}catch(r){i=!0,a=r}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}}},[t]),u=Object(r.debounce)(l,300);return Object(i.useLayoutEffect)(function(){if(t.current)return u(),window.addEventListener("resize",u),function(){window.removeEventListener("resize",u)}},[t.current]),o}(n,[e.onResize]),c=(function(t,e){var n=Object(i.useRef)(t);Object(i.useLayoutEffect)(function(){n.current=t},[t]);var a=Object(i.useRef)();Object(i.useLayoutEffect)(function(){var n=t.current;if(null!=n)return e.setCanvas(n),a.current=requestAnimationFrame(e.doFrame),n.addEventListener("touchstart",e.touchStart),n.addEventListener("touchmove",e.touchMove),n.addEventListener("touchend",e.touchEnd),n.addEventListener("click",e.mouseLeft),n.addEventListener("contextmenu",e.mouseRight),function(){cancelAnimationFrame(a.current),n.removeEventListener("touchstart",e.touchStart),n.removeEventListener("touchmove",e.touchMove),n.removeEventListener("touchend",e.touchEnd),n.removeEventListener("click",e.mouseLeft),n.removeEventListener("contextmenu",e.mouseRight)}},[])}(n,e),o.width),l=o.height;return a.a.createElement("div",{className:"Canvas"},a.a.createElement("canvas",{ref:n,height:l,width:c}))},u=n(8),v=n(6),f=n(7),d=["#ffffff","#c0c0c0","#FF0000","#800000","#FFFF00","#00FF00","#008000","#7fffd4","#008080","#1e90ff","#000080","#FF00FF","#663399","#ffa500","#ff69b4"],g=Object.freeze({color:"black",lineWidth:5,callback:function(){},callbackInterval:1});function m(t,e,n){var i=Object.assign({},g,n),a=i.lineWidth,o=i.color,c=i.callback,s=t.getContext("2d"),r=t.width-a,h=t.height-a,l=2*(r+h),u=a/2,v=e/i.callbackInterval,f=0,d=l/e,m=0;return{reset:function(){m=0,f=0},draw:function(t){(m+=t)>e&&(m=e),m>=(f+1)*v&&(console.log("invocation ".concat(f)),c(),f++),s.beginPath(),s.lineWidth=a,s.strokeStyle=o,s.moveTo(u,u);var n=d*m;return n<=r?(s.lineTo(n+u,u),void s.stroke()):(s.lineTo(r+u,u),(n-=r)<=h?(s.lineTo(r+u,n+u),void s.stroke()):(s.lineTo(r+u,h+u),(n-=h)<=r?(s.lineTo(r-n+u,h+u),void s.stroke()):(s.lineTo(u,h+u),(n-=r)<=h?(s.lineTo(u,h-n+u),void s.stroke()):(s.lineTo(u,u),void s.stroke()))))}}}var T,y,w=n(18)();!function(t){t[t.Normal=0]="Normal",t[t.Animating=1]="Animating",t[t.AnimationFinished=2]="AnimationFinished"}(T||(T={})),function(t){t[t.Vanishing=0]="Vanishing",t[t.Unvanishing=1]="Unvanishing"}(y||(y={}));var b={frames:45,vanishLength:2500,frameDelay:100};var p=function(t,e){for(var n=[],i=[],a=0;a<e;a++)n.push(Math.pow(e-Math.abs(t-a),e/2)),i.push(a);return w.weighted(i,n)};function F(t,e,n){for(var i=[],a=t.data,o=t.data.slice(0).fill(0),c=t.width,s=t.height,r=Array.from({length:e},function(t){return o.slice(0)}),h=0;h<a.length;h+=4){var l=Math.floor(h/a.length*e),u=r[p(l,e)];if(u[h]=a[h],u[h+1]=a[h+1],u[h+2]=a[h+2],u[h+3]=a[h+3],void 0!=n){var v=E(n);u[h]===v.red&&u[h+1]===v.green&&u[h+2]===v.blue||(u[h]=0,u[h+1]=0,u[h+2]=0,u[h+3]=0)}}for(var f=0;f<r.length;f++){var d=new Image,g=document.createElement("canvas");g.width=c,g.height=s,g.getContext("2d").putImageData(new ImageData(r[f],c,s),0,0),d.src=g.toDataURL("image/png"),i.push(d)}return i}function E(t){var e=parseInt(t.replace("#","0x"));return{red:e>>16&255,green:e>>8&255,blue:255&e}}var k,L,O=60,x="black";!function(t){t[t.Initializing=0]="Initializing",t[t.Empty=1]="Empty",t[t.Listening=2]="Listening",t[t.Selecting=3]="Selecting",t[t.Finished=4]="Finished"}(k||(k={})),function(t){t[t.FirstOnly=0]="FirstOnly",t[t.FullOrder=1]="FullOrder",t[t.Teams=2]="Teams"}(L||(L={}));var S=function(){function t(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:L.Teams;arguments.length>1&&arguments[1];Object(v.a)(this,t),this.touchStart=void 0,this.touchMove=void 0,this.touchEnd=void 0,this.mouseLeft=void 0,this.mouseRight=void 0,this.lastFrame=void 0,this.canvas=void 0,this.ctx=void 0,this.width=void 0,this.height=void 0,this.activeTouches=void 0,this.colors=void 0,this.offset=void 0,this._state=void 0,this.enableResetFlag=void 0,this.selectionMode=void 0,this.teamCount=void 0,this.countDownToLock=void 0,this.countDownToSelect=void 0,this.selectedIndex=void 0,this.setCanvas=function(t){e.canvas=t,e.ctx=e.canvas.getContext("2d"),e.onResize()},this.onResize=function(){var t=e.canvas.getBoundingClientRect();e.offset={x:t.left,y:t.top};var n=e.canvas;e.width=n.width,e.height=n.height,e.countDownToLock=m(n,2e3,{color:"red",callback:e.lockPlayers,lineWidth:10})},this.lockPlayers=function(){var t=e.activeTouches.length,n=e.selectionMode===L.FirstOnly?e.activeTouches.length-1:e.activeTouches.length;e.countDownToSelect=m(e.canvas,Object(r.clamp)(400*(t-1),1e3,3e3),{color:"yellow",callback:e.selectRandomPlayer,callbackInterval:n,lineWidth:10});for(var i={vanishLength:1200,frameDelay:35,callback:e.selectionMode==L.Teams},a=Object(r.shuffle)(Array.from(Array(t).keys())),o=new Array(e.teamCount),c=new Array(t),s=0;s<e.teamCount;s++)o[s]=[];if(e.selectionMode===L.Teams)for(var h=0;h<a.length;h++)o[h%e.teamCount].push(e.activeTouches[a[h]]),c[a[h]]=o[h%e.teamCount][0].id;console.log(o),e.activeTouches=e.activeTouches.map(function(t){var n={};return e.selectionMode===L.Teams&&(n=Object.assign(n,{nextColor:e.activeTouches[c[t.id]].color})),function(t,e,n){var i=Object.assign({},b,n),a=T.Normal,o=t.draw,c=0,s=y.Vanishing,h=[],l={vanishOptions:i,getMode:function(){return s},setMode:function(t){s=t,c=0,this.setState(T.Animating)},getState:function(){return a},setState:function(e){a!=e&&((a=e)==T.Normal?c=0:a==T.Animating?(c=0,0==h.length&&(t.imageData,h=F(t.imageData,i.frames,t.color))):a==T.AnimationFinished&&(i.callback&&s==y.Vanishing?(t.color=i.nextColor,t.loadImageData(),this.reloadFrames(),this.setMode(y.Unvanishing)):s==y.Unvanishing&&this.setState(T.Normal)))},reloadFrames:function(){h=F(t.imageData,i.frames,t.color)},draw:function(e,n){if(a==T.Normal)o(e,n);else if(a==T.Animating){if((c+=n)>=h.length*i.frameDelay+i.vanishLength)return void this.setState(T.AnimationFinished);var l=t.position.x,u=t.position.y;if("radius"in t){var v=t.radius;l-=v,u-=v}for(var f=0;f<h.length;f++){var d=c-(f+1)*i.frameDelay,g=Object(r.clamp)(1-d/i.vanishLength,0,1);s==y.Unvanishing&&(g=1-g),e.globalAlpha=g,e.drawImage(h[f],l,u)}e.globalAlpha=1}}};return Object.assign({},t,l)}(t,e.ctx,Object.assign(n,i))}),e.state=k.Selecting},this.selectRandomPlayer=function(){var t=e.activeTouches.filter(function(t){return t.getState()===T.Normal}),n=t[Math.floor(Math.random()*t.length)].id,i=e.activeTouches.findIndex(function(t){return t.id==n});e.activeTouches[i].setState(T.Animating);var a=e.selectionMode==L.FirstOnly?2:1;t.length==a&&(e.state=k.Finished)},this.copyTouch=function(t){var n=t.identifier;return function(t,e,n,i){var a,o=n;return{get id(){return t},get imageData(){return a},get position(){return o},set position(t){o=t},get radius(){return i},set radius(t){i=t},get color(){return e},set color(t){e=t},loadImageData:function(){var t=document.createElement("canvas");t.width=2*i,t.height=2*i;var n=t.getContext("2d");n.fillStyle="black",n.fillRect(0,0,t.width,t.height),n.fillStyle=e,n.arc(i,i,i,0,2*Math.PI),n.fill(),a=n.getImageData(0,0,2*i,2*i)},draw:function(t,n){if(t.beginPath(),t.fillStyle=e,t.arc(o.x,o.y,i,0,2*Math.PI),t.fill(),void 0==a){var c=document.createElement("canvas"),s=c.getContext("2d");c.width=2*i,c.height=2*i,s.fillStyle="black",s.fillRect(0,0,c.width,c.height),s.fillStyle=e,s.arc(i,i,i,0,2*Math.PI),s.fill(),a=s.getImageData(0,0,2*i,2*i)}}}}(n,e.colors[n],{x:t.pageX-e.offset.x,y:t.pageY-e.offset.y},O)},this.updateTouches=function(t){if(e.state==k.Empty||e.state==k.Listening){var n=Array.from(t.targetTouches);n.length!=e.activeTouches.length&&e.countDownToLock.reset(),e.activeTouches=n.map(function(t){return e.copyTouch(t)});var i=e.activeTouches.length;i<=1&&(e.state=k.Empty),i>1&&(e.state=k.Listening)}e.state==k.Finished&&(t.targetTouches.length>0&&e.enableResetFlag&&(e.state=k.Empty,e.enableResetFlag=!1),0==t.targetTouches.length&&(e.enableResetFlag=!0))},this.clickAsTouch=function(t){if(e.state==k.Empty||e.state==k.Listening){var n={identifier:e.activeTouches.length,pageX:t.clientX,pageY:t.clientY},i=e.copyTouch(n);e.activeTouches=[].concat(Object(u.a)(e.activeTouches),[i]),e.activeTouches.length>1&&e.state==k.Empty&&(e.state=k.Listening),e.countDownToLock.reset()}e.state==k.Finished&&(e.activeTouches=[],e.state=k.Empty)},this.clickToCancel=function(t){if(t.preventDefault(),0!=e.activeTouches.length&&e.state!=k.Selecting){if(e.state==k.Finished)return e.activeTouches=[],void(e.state=k.Empty);e.activeTouches=e.activeTouches.slice(0,-1),e.activeTouches.length<=1&&(e.state=k.Empty),e.countDownToLock.reset()}},this.doFrame=function(t){var n=t-e.lastFrame;if(e.lastFrame=t,window.requestAnimationFrame(e.doFrame),null!=e.ctx&&void 0!=e.ctx){var i=e.ctx;i.fillStyle=x,i.fillRect(0,0,e.width,e.height),e.state==k.Empty&&e.countDownToLock.reset(),e.state==k.Listening&&e.countDownToLock.draw(n),e.state==k.Selecting&&e.countDownToSelect.draw(n);var a=!0,o=!1,c=void 0;try{for(var s,r=e.activeTouches[Symbol.iterator]();!(a=(s=r.next()).done);a=!0){s.value.draw(i,n)}}catch(h){o=!0,c=h}finally{try{a||null==r.return||r.return()}finally{if(o)throw c}}}},this.lastFrame=0,this.touchStart=this.updateTouches,this.touchMove=this.updateTouches,this.touchEnd=this.updateTouches,this.mouseLeft=this.clickAsTouch,this.mouseRight=this.clickToCancel,this._state=k.Initializing,this.canvas=null,this.ctx=null,this.countDownToLock=null,this.selectedIndex=-1,this.selectionMode=n,this.teamCount=2,this.activeTouches=[],this.colors=Object(r.shuffle)(d),this.offset={x:0,y:0},this.height=this.width=0,this.state=k.Empty,this.enableResetFlag=!1}return Object(f.a)(t,[{key:"state",get:function(){return this._state},set:function(t){t!==this._state&&(this._state=t,this._state===k.Empty&&(this.colors=Object(r.shuffle)(d)))}}]),t}(),D=function(){return a.a.createElement("div",{className:"App"},a.a.createElement(l,{height:400,width:600,animator:new S}))};c.a.render(a.a.createElement(D,null),document.getElementById("root"))},9:function(t,e,n){t.exports=n(23)}},[[9,1,2]]]);
//# sourceMappingURL=main.4af2ce08.chunk.js.map